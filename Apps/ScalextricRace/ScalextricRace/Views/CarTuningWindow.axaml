<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:ScalextricRace.ViewModels"
        x:Class="ScalextricRace.Views.CarTuningWindow"
        x:DataType="vm:CarTuningViewModel"
        Title="Car Tuning"
        Width="450" Height="480"
        MinWidth="400" MinHeight="450"
        WindowStartupLocation="CenterOwner"
        CanResize="False">

    <Grid RowDefinitions="Auto,*,Auto" Margin="20">

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel>
                    <TextBlock Text="{Binding CarName}"
                               FontSize="22"
                               FontWeight="Bold" />
                    <TextBlock Text="{Binding StageTitle, StringFormat='Step {0}: {1}'}"
                               FontSize="14"
                               Foreground="Gray">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="Step {0} of 3: {1}">
                                <Binding Path="StageNumber" />
                                <Binding Path="StageTitle" />
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>
                <Button Grid.Column="1"
                        Content="Cancel"
                        Command="{Binding CancelCommand}"
                        VerticalAlignment="Top"
                        Padding="15,8" />
            </Grid>
        </StackPanel>

        <!-- Main Content -->
        <Border Grid.Row="1"
                Background="#F5F5F5"
                CornerRadius="8"
                Padding="20">
            <StackPanel Spacing="20">

                <!-- Stage Description -->
                <TextBlock Text="{Binding StageDescription}"
                           TextWrapping="Wrap"
                           FontSize="13"
                           Foreground="#555555" />

                <!-- Slot Selection -->
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <TextBlock Text="Slot:"
                               VerticalAlignment="Center"
                               FontSize="14" />
                    <ComboBox ItemsSource="{Binding AvailableSlots}"
                              SelectedItem="{Binding SelectedSlot}"
                              MinWidth="80"
                              FontSize="14" />
                    <TextBlock Text="(Place car on this slot)"
                               VerticalAlignment="Center"
                               FontSize="12"
                               Foreground="Gray" />
                </StackPanel>

                <!-- Power Level Control -->
                <StackPanel Spacing="10">
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="Power Level"
                                   FontSize="14"
                                   VerticalAlignment="Center" />
                        <TextBlock Grid.Column="1"
                                   Text="{Binding PowerLevel}"
                                   FontSize="24"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center" />
                    </Grid>

                    <!-- Slider with +/- buttons -->
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <Button Grid.Column="0"
                                Content="-"
                                Command="{Binding DecrementPowerCommand}"
                                Width="45" Height="45"
                                FontSize="20"
                                FontWeight="Bold"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center" />
                        <Slider Grid.Column="1"
                                Minimum="0"
                                Maximum="63"
                                Value="{Binding PowerLevel}"
                                Margin="15,0"
                                VerticalAlignment="Center" />
                        <Button Grid.Column="2"
                                Content="+"
                                Command="{Binding IncrementPowerCommand}"
                                Width="45" Height="45"
                                FontSize="20"
                                FontWeight="Bold"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center" />
                    </Grid>
                </StackPanel>

                <!-- Start/Stop Button -->
                <Button Content="{Binding PowerButtonText}"
                        Command="{Binding TogglePowerCommand}"
                        HorizontalAlignment="Center"
                        Padding="40,12"
                        FontSize="16"
                        FontWeight="SemiBold" />

                <!-- Stage-specific help text (inside main content) -->
                <TextBlock Text="Use the throttle to test the car at this power limit."
                           FontSize="11"
                           Foreground="Gray"
                           HorizontalAlignment="Center"
                           IsVisible="{Binding IsDefaultPowerStage}" />
                <TextBlock Text="The slider directly controls the car speed. Find max speed before crashing."
                           FontSize="11"
                           Foreground="Gray"
                           HorizontalAlignment="Center"
                           IsVisible="{Binding IsGhostMaxPowerStage}" />
                <TextBlock Text="The slider directly controls the car speed. Find the lowest speed before stalling."
                           FontSize="11"
                           Foreground="Gray"
                           HorizontalAlignment="Center"
                           IsVisible="{Binding IsMinPowerStage}" />

            </StackPanel>
        </Border>

        <!-- Footer -->
        <StackPanel Grid.Row="2" Margin="0,20,0,0" HorizontalAlignment="Right">
            <Button Content="{Binding ContinueButtonText}"
                    Command="{Binding SaveAndContinueCommand}"
                    Padding="25,10"
                    FontSize="14"
                    FontWeight="SemiBold" />
        </StackPanel>

    </Grid>
</Window>
